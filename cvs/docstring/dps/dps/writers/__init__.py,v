head	1.9;
access;
symbols;
locks; strict;
comment	@# @;


1.9
date	2002.04.04.05.53.32;	author goodger;	state Exp;
branches;
next	1.8;

1.8
date	2002.03.28.04.47.47;	author goodger;	state Exp;
branches;
next	1.7;

1.7
date	2002.03.16.05.53.52;	author goodger;	state Exp;
branches;
next	1.6;

1.6
date	2002.03.07.04.00.40;	author goodger;	state Exp;
branches;
next	1.5;

1.5
date	2002.02.22.02.01.11;	author goodger;	state Exp;
branches;
next	1.4;

1.4
date	2002.02.20.04.14.52;	author goodger;	state Exp;
branches;
next	1.3;

1.3
date	2002.02.12.02.13.38;	author goodger;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.07.01.58.29;	author goodger;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.06.02.56.21;	author goodger;	state Exp;
branches;
next	;


desc
@@


1.9
log
@blank line
@
text
@#! /usr/bin/env python

"""
:Authors: David Goodger
:Contact: goodger@@users.sourceforge.net
:Revision: $Revision: 1.8 $
:Date: $Date: 2002/03/28 04:47:47 $
:Copyright: This module has been placed in the public domain.

This package contains Docutils Writer modules.
"""

__docformat__ = 'reStructuredText'


import sys
from dps import languages
from dps.transforms import universal


class Writer:

    """
    Abstract base class for docutils Writers.

    Each writer module or package must export a subclass also called 'Writer'.

    Call `write()` to process a document.
    """

    document = None
    """The document to write."""

    language = None
    """Language module for the document."""

    destination = None
    """Where to write the document."""

    transforms = ()
    """Ordered list of transform classes (each with a ``transform()`` method).
    Populated by subclasses. `Writer.transform()` instantiates & runs them."""

    def __init__(self):
        """Initialize the Writer instance."""

        self.transforms = list(self.transforms)
        """Instance copy of `Writer.transforms`; may be modified by client."""

    def write(self, document, destination):
        self.document = document
        self.language = languages.getlanguage(document.languagecode)
        self.destination = destination
        self.transform()
        self.translate()
        self.record()

    def transform(self):
        """Run all of the transforms defined for this Writer."""
        for xclass in (universal.first_writer_transforms
                       + tuple(self.transforms)
                       + universal.last_writer_transforms):
            xclass(self.document).transform()

    def translate(self):
        """Override to do final document tree translation."""
        raise NotImplementedError('subclass must override this method')

    def record(self):
        """Override to record `document` to `destination`."""
        raise NotImplementedError('subclass must override this method')

    def recordfile(self, output, destination):
        """
        Write `output` to a single file.

        Parameters:

        - `output`: Data to write.
        - `destination`: one of:

          (a) a file-like object, which is written directly;
          (b) a path to a file, which is opened and then written; or
          (c) `None`, which implies `sys.stdout`.
        """
        output = output.encode('raw-unicode-escape')    # @@@@@@ temporary
        if hasattr(self.destination, 'write'):
            destination.write(output)
        elif self.destination:
            open(self.destination, 'w').write(output)
        else:
            sys.stdout.write(output)


_writer_aliases = {}

def get_writer_class(writername):
    """Return the Writer class from the `writername` module."""
    writername = writername.lower()
    if _writer_aliases.has_key(writername):
        writername = _writer_aliases[writername]
    module = __import__(writername, globals(), locals())
    return module.Writer
@


1.8
log
@docstring mods
@
text
@d6 2
a7 2
:Revision: $Revision: 1.7 $
:Date: $Date: 2002/03/16 05:53:52 $
d78 1
@


1.7
log
@transform API update
@
text
@d6 2
a7 2
:Revision: $Revision: 1.6 $
:Date: $Date: 2002/03/07 04:00:40 $
d10 1
a10 1
This package contains DPS Writer modules.
a14 2
__all__ = ['Writer', 'get_writer_class']

d25 2
@


1.6
log
@(temporary?) Unicode "support"
@
text
@d6 2
a7 2
:Revision: $Revision: 1.5 $
:Date: $Date: 2002/02/22 02:01:11 $
d63 1
a63 1
            xclass().transform(self.document)
d85 1
a85 1
        output = output.encode('raw-unicode-escape')    # @@@@@@ temporary?
@


1.5
log
@  - Added support for universal transforms.
@
text
@d6 2
a7 2
:Revision: $Revision: 1.4 $
:Date: $Date: 2002/02/20 04:14:52 $
d85 1
@


1.4
log
@language module support (may drop)
@
text
@d6 2
a7 2
:Revision: $Revision: 1.3 $
:Date: $Date: 2002/02/12 02:13:38 $
d18 1
d20 1
a20 1
import sys
d60 3
a62 1
        for xclass in self.transforms:
@


1.3
log
@rearranged & improved
@
text
@d6 2
a7 2
:Revision: $Revision: 1.2 $
:Date: $Date: 2002/02/07 01:58:29 $
d18 1
d33 3
d51 1
@


1.2
log
@progress
@
text
@d6 2
a7 2
:Revision: $Revision: 1.1 $
:Date: $Date: 2002/02/06 02:56:21 $
d29 16
d49 2
a50 1
        self.record(self.document, self.destination)
d53 6
a58 1
        """Override to run document tree transforms."""
d61 1
a61 1
    def record(self, document, destination):
a82 1
    pass
@


1.1
log
@*** empty log message ***
@
text
@d6 2
a7 2
:Revision: $Revision:$
:Date: $Date:$
d18 3
d29 32
@

